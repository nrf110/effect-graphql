---
title: Server Integration
description: Run your GraphQL server on Node.js, Bun, Express, or any platform
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

Effect GraphQL provides platform-specific packages for running your GraphQL server. Each package integrates seamlessly with `@effect/platform` and provides consistent APIs across different runtimes.

## Available Packages

| Package | Platform | Install |
|---------|----------|---------|
| `@effect-graphql/node` | Node.js | `npm install @effect-graphql/node` |
| `@effect-graphql/bun` | Bun | `npm install @effect-graphql/bun` |
| `@effect-graphql/express` | Express.js | `npm install @effect-graphql/express` |
| `@effect-graphql/web` | Web standards | `npm install @effect-graphql/web` |

## Quick Start with Node.js

The fastest way to get a GraphQL server running:

```typescript
import { GraphQLSchemaBuilder, query, toRouter } from "@effect-graphql/core"
import { serve } from "@effect-graphql/node"
import { Effect, Layer } from "effect"
import * as S from "effect/Schema"

// Build your schema
const builder = GraphQLSchemaBuilder.empty.pipe(
  query("hello", {
    type: S.String,
    resolve: () => Effect.succeed("Hello, World!")
  })
)

// Convert to router and serve
const router = toRouter(builder, Layer.empty, { graphiql: true })

serve(router, Layer.empty, {
  port: 4000,
  onStart: (url) => console.log(`ðŸš€ Server running at ${url}`)
})
```

## Core Concepts

### The Router

The `HttpRouter` from `@effect/platform` is the central abstraction for HTTP handling. Effect GraphQL provides two ways to create a GraphQL router:

#### Using `toRouter` (Recommended)

Converts a `GraphQLSchemaBuilder` directly to an `HttpRouter`:

```typescript
import { GraphQLSchemaBuilder, toRouter } from "@effect-graphql/core"
import { Layer } from "effect"

const builder = GraphQLSchemaBuilder.empty.pipe(
  // ... define your schema
)

const router = toRouter(builder, serviceLayer, {
  path: "/graphql",      // GraphQL endpoint (default: "/graphql")
  graphiql: true         // Enable GraphiQL UI
})
```

#### Using `makeGraphQLRouter`

If you already have a built `GraphQLSchema`:

```typescript
import { makeGraphQLRouter } from "@effect-graphql/core"

const schema = builder.buildSchema()

const router = makeGraphQLRouter(schema, serviceLayer, {
  path: "/graphql",
  graphiql: {
    path: "/graphiql",        // Where GraphiQL is served
    endpoint: "/graphql"       // Where GraphiQL sends requests
  }
})
```

### Router Configuration

Both `toRouter` and `makeGraphQLRouter` accept a configuration object:

```typescript
interface GraphQLRouterConfigInput {
  // Path for GraphQL endpoint (default: "/graphql")
  path?: string

  // GraphiQL configuration
  graphiql?: boolean | {
    path?: string      // Path for GraphiQL UI (default: "/graphiql")
    endpoint?: string  // GraphQL endpoint URL (default: same as path)
  }
}
```

**Examples:**

```typescript
// Minimal - GraphQL at /graphql, no GraphiQL
const router = toRouter(builder, layer)

// Enable GraphiQL with defaults
const router = toRouter(builder, layer, { graphiql: true })

// Custom paths
const router = toRouter(builder, layer, {
  path: "/api/graphql",
  graphiql: {
    path: "/playground",
    endpoint: "/api/graphql"
  }
})
```

## Platform-Specific Usage

### Node.js

<Tabs>
  <TabItem label="Basic Server">
```typescript
import { toRouter } from "@effect-graphql/core"
import { serve } from "@effect-graphql/node"

const router = toRouter(builder, serviceLayer, { graphiql: true })

serve(router, serviceLayer, {
  port: 4000,
  host: "0.0.0.0",
  onStart: (url) => console.log(`Server at ${url}`)
})
```
  </TabItem>
  <TabItem label="With Subscriptions">
```typescript
import { toRouter } from "@effect-graphql/core"
import { serve } from "@effect-graphql/node"

const schema = builder.buildSchema()
const router = toRouter(builder, serviceLayer, { graphiql: true })

serve(router, serviceLayer, {
  port: 4000,
  subscriptions: {
    schema,
    path: "/graphql",
    onConnect: (params) => Effect.gen(function* () {
      // Validate auth token
      const user = yield* AuthService.validateToken(params.authToken)
      return { user }
    })
  },
  onStart: (url) => console.log(`Server at ${url}`)
})
```
  </TabItem>
  <TabItem label="Custom HTTP Server">
```typescript
import { HttpApp } from "@effect/platform"
import { createServer } from "node:http"
import { createGraphQLWSServer } from "@effect-graphql/node"

const schema = builder.buildSchema()
const { handler } = HttpApp.toWebHandlerLayer(router, serviceLayer)

const httpServer = createServer(async (req, res) => {
  // Handle HTTP requests with Effect router
  const response = await handler(new Request(...))
  // Write response...
})

// Add WebSocket support
const { handleUpgrade, close } = createGraphQLWSServer(schema, serviceLayer)
httpServer.on("upgrade", (req, socket, head) => handleUpgrade(req, socket, head))

httpServer.listen(4000)
```
  </TabItem>
</Tabs>

### Bun

```typescript
import { toRouter } from "@effect-graphql/core"
import { serve } from "@effect-graphql/bun"

const router = toRouter(builder, serviceLayer, { graphiql: true })

serve(router, serviceLayer, {
  port: 4000,
  onStart: (url) => console.log(`Server at ${url}`)
})
```

### Express

```typescript
import express from "express"
import { graphqlMiddleware } from "@effect-graphql/express"

const app = express()

const schema = builder.buildSchema()

app.use("/graphql", graphqlMiddleware(schema, serviceLayer))

app.listen(4000)
```

## Environment Configuration

Load router configuration from environment variables using `GraphQLRouterConfigFromEnv`:

```typescript
import { Effect, Layer } from "effect"
import { GraphQLRouterConfigFromEnv, makeGraphQLRouter } from "@effect-graphql/core"

const program = Effect.gen(function* () {
  const config = yield* GraphQLRouterConfigFromEnv
  const router = makeGraphQLRouter(schema, layer, config)
  // Use router...
})
```

**Environment Variables:**

| Variable | Description | Default |
|----------|-------------|---------|
| `GRAPHQL_PATH` | GraphQL endpoint path | `/graphql` |
| `GRAPHIQL_ENABLED` | Enable GraphiQL UI | `false` |
| `GRAPHIQL_PATH` | GraphiQL UI path | `/graphiql` |
| `GRAPHIQL_ENDPOINT` | GraphQL URL for GraphiQL | Same as `GRAPHQL_PATH` |

**Example:**

```bash
GRAPHQL_PATH=/api/graphql
GRAPHIQL_ENABLED=true
GRAPHIQL_PATH=/playground
```

## Composing Routes

The GraphQL router can be composed with other routes:

```typescript
import { HttpRouter, HttpServerResponse } from "@effect/platform"
import { toRouter } from "@effect-graphql/core"

const graphqlRouter = toRouter(builder, serviceLayer, { graphiql: true })

const app = HttpRouter.empty.pipe(
  // Health check endpoint
  HttpRouter.get("/health", HttpServerResponse.json({ status: "ok" })),

  // Static files
  HttpRouter.get("/docs/*", serveStaticFiles),

  // GraphQL routes
  HttpRouter.concat(graphqlRouter)
)
```

## GraphiQL

When enabled, GraphiQL provides an interactive IDE for exploring your GraphQL API:

- **Syntax highlighting** for queries
- **Auto-complete** with schema introspection
- **Query history** for recent operations
- **Documentation explorer** for browsing types

The GraphiQL UI is loaded from CDN (unpkg.com) with no local dependencies.

```typescript
// Enable with defaults
const router = toRouter(builder, layer, { graphiql: true })
// Access at: http://localhost:4000/graphiql

// Custom configuration
const router = toRouter(builder, layer, {
  path: "/api/graphql",
  graphiql: {
    path: "/playground",
    endpoint: "/api/graphql"
  }
})
// Access at: http://localhost:4000/playground
```

## Service Layer Integration

The service layer you provide is used to resolve Effect service dependencies in your resolvers:

```typescript
import { Context, Effect, Layer } from "effect"

// Define a service
class Database extends Context.Tag("Database")<Database, {
  getUsers: () => Effect.Effect<User[]>
}>() {}

// Create the layer
const DatabaseLive = Layer.succeed(Database, {
  getUsers: () => Effect.succeed([{ id: "1", name: "Alice" }])
})

// Use in resolver
const builder = GraphQLSchemaBuilder.empty.pipe(
  query("users", {
    type: S.Array(UserSchema),
    resolve: () => Effect.gen(function* () {
      const db = yield* Database
      return yield* db.getUsers()
    })
  })
)

// Provide layer when creating router
const router = toRouter(builder, DatabaseLive, { graphiql: true })
```

## Error Handling

HTTP-level errors are handled automatically:

- **Parse errors** â†’ 400 Bad Request
- **Validation errors** â†’ 400 Bad Request
- **Resolver errors** â†’ 200 OK with `errors` array (per GraphQL spec)
- **Unexpected errors** â†’ 400 Bad Request with generic message

For application-level errors, see the [Error Handling guide](/effect-graphql/guides/error-handling).

## Next Steps

- [WebSocket Subscriptions](/effect-graphql/guides/subscriptions) - Real-time data with graphql-ws
- [DataLoader Integration](/effect-graphql/guides/dataloader) - Batch and cache database queries
- [Error Handling](/effect-graphql/guides/error-handling) - Structured error responses
